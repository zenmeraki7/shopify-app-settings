{% comment %}
  Social Share Buttons Section for Shopify
  Allows customers to share products on various social platforms
{% endcomment %}

{% schema %}
{
  "name": "Social Share",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Share this product"
    },
    {
      "type": "checkbox",
      "id": "show_messenger",
      "label": "Show Messenger",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_twitter",
      "label": "Show Twitter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_instagram",
      "label": "Show Instagram",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_whatsapp",
      "label": "Show WhatsApp",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_snapchat",
      "label": "Show Snapchat",
      "default": true
    }
  ]
}
{% endschema %}

<style>
  .social-share-container {
    text-align: center;
    padding: 20px;
  }

  .social-share-heading {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 15px;
  }

  .social-share-buttons {
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  .social-btn {
    width: 50px;
    height: 50px; 
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: #f0f0f0; 
    transition: transform 0.2s ease-in-out;
  }

  .social-btn img {
    width: 28px; 
    height: 28px;
    object-fit: contain;
  }
  .social-btn:hover {
    transform: scale(1.1);
  }
</style>

<div class="social-share-container">
  <p class="social-share-heading">{{ block.settings.heading }}</p>

  {%- liquid
    assign product_url = shop.url | append: product.url
    assign product_title = product.title | url_encode
    assign image_url = product.featured_image | img_url: 'large' | url_encode
  -%}
  
  <div class="social-share-buttons">
    
    {% if block.settings.show_messenger %}
      <a href="https://www.messenger.com/new?link={{ product_url | url_encode }}"
         target="_blank" rel="noopener" class="social-btn messenger"
         onclick="copyAndOpen(event, '{{ product_url }}', this.href)">
        <img src="{{ 'messenger.png' | asset_url }}" alt="Messenger">
      </a>
    {% endif %}

    {% if block.settings.show_twitter %}
      <a href="https://twitter.com/messages/compose" 
         target="_blank" class="social-btn twitter"
         onclick="copyAndOpen(event, '{{ product_url }}', this.href)">
        <img src="{{ 'x.png' | asset_url }}" alt="Twitter">
      </a>
    {% endif %}

    {% if block.settings.show_instagram %}
      <a href="https://www.instagram.com/direct/inbox/" 
         target="_blank" class="social-btn insta"
         onclick="copyAndOpen(event, '{{ product_url }}', this.href)">
        <img src="{{ 'instagram.jpeg' | asset_url }}" alt="Instagram">
      </a>
    {% endif %}

    {% if block.settings.show_whatsapp %}
      <a href="https://api.whatsapp.com/send?text={{ product_title }}%20{{ product_url | url_encode }}"
         target="_blank" rel="noopener" class="social-btn whatsapp"
         aria-label="Share on WhatsApp">
        <img src="{{ 'whatsapp.png' | asset_url }}" alt="WhatsApp">
      </a>
    {% endif %}

    {% if block.settings.show_snapchat %}
      <a href="https://www.snapchat.com/share?url={{ product_url | url_encode }}"
         target="_blank" class="social-btn snapchat"
         onclick="copyAndOpen(event, '{{ product_url }}', this.href)">
        <img src="{{ 'snapchat.png' | asset_url }}" alt="Snapchat">
      </a>
    {% endif %}

  </div>
</div>


<script>
function copyAndOpen(event, link, url) {
  event.preventDefault(); // Prevent immediate navigation

  navigator.clipboard.writeText(link)
    .then(() => {
      console.log("Link copied to clipboard:", link);
      setTimeout(() => {
        window.open(url, "_blank"); // Open the social media share link
      }, 300); // Small delay to ensure the copy function runs
    })
    .catch(err => {
      console.error("Failed to copy link:", err);
      window.open(url, "_blank"); // Open link anyway if copying fails
    });
}

</script>

